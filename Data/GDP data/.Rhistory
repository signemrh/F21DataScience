filter(!is.na(Date))
# make it into a tsibble
t_acc_data <- group_acc_data
# Make states into names instead of numbers
t_acc_data$STATE[t_acc_data$STATE == 1] <- "Alabama"
t_acc_data$STATE[t_acc_data$STATE == 2] <- "Alaska"
t_acc_data$STATE[t_acc_data$STATE == 4] <- "Arizona"
t_acc_data$STATE[t_acc_data$STATE == 5] <- "Arkansas"
t_acc_data$STATE[t_acc_data$STATE == 6] <- "California"
t_acc_data$STATE[t_acc_data$STATE == 8] <- "Colorado"
t_acc_data$STATE[t_acc_data$STATE == 9] <- "Connecticut"
t_acc_data$STATE[t_acc_data$STATE == 10] <- "Delaware"
t_acc_data$STATE[t_acc_data$STATE == 11] <- "District of Columbia"
t_acc_data$STATE[t_acc_data$STATE == 12] <- "Florida"
t_acc_data$STATE[t_acc_data$STATE == 13] <- "Georgia"
t_acc_data$STATE[t_acc_data$STATE == 15] <- "Hawaii"
t_acc_data$STATE[t_acc_data$STATE == 16] <- "Idaho"
t_acc_data$STATE[t_acc_data$STATE == 17] <- "Illinois"
t_acc_data$STATE[t_acc_data$STATE == 18] <- "Indiana"
t_acc_data$STATE[t_acc_data$STATE == 19] <- "Iowa"
t_acc_data$STATE[t_acc_data$STATE == 20] <- "Kansas"
t_acc_data$STATE[t_acc_data$STATE == 21] <- "Kentucky"
t_acc_data$STATE[t_acc_data$STATE == 22] <- "Louisiana"
t_acc_data$STATE[t_acc_data$STATE == 23] <- "Maine"
t_acc_data$STATE[t_acc_data$STATE == 24] <- "Maryland"
t_acc_data$STATE[t_acc_data$STATE == 25] <- "Massachusetts"
t_acc_data$STATE[t_acc_data$STATE == 26] <- "Michigan"
t_acc_data$STATE[t_acc_data$STATE == 27] <- "Minnesota"
t_acc_data$STATE[t_acc_data$STATE == 28] <- "Mississippi"
t_acc_data$STATE[t_acc_data$STATE == 29] <- "Missouri"
t_acc_data$STATE[t_acc_data$STATE == 30] <- "Montana"
t_acc_data$STATE[t_acc_data$STATE == 31] <- "Nebraska"
t_acc_data$STATE[t_acc_data$STATE == 32] <- "Nevada"
t_acc_data$STATE[t_acc_data$STATE == 33] <- "New Hampshire"
t_acc_data$STATE[t_acc_data$STATE == 34] <- "New Jersey"
t_acc_data$STATE[t_acc_data$STATE == 35] <- "New Mexico"
t_acc_data$STATE[t_acc_data$STATE == 36] <- "New York"
t_acc_data$STATE[t_acc_data$STATE == 37] <- "North Carolina"
t_acc_data$STATE[t_acc_data$STATE == 38] <- "North Dakota"
t_acc_data$STATE[t_acc_data$STATE == 39] <- "Ohio"
t_acc_data$STATE[t_acc_data$STATE == 40] <- "Oklahoma"
t_acc_data$STATE[t_acc_data$STATE == 41] <- "Oregon"
t_acc_data$STATE[t_acc_data$STATE == 42] <- "Pennsylvania"
t_acc_data$STATE[t_acc_data$STATE == 43] <- "Puerto Rico"
t_acc_data$STATE[t_acc_data$STATE == 44] <- "Rhode Island"
t_acc_data$STATE[t_acc_data$STATE == 45] <- "South Carolina"
t_acc_data$STATE[t_acc_data$STATE == 46] <- "South Dakota"
t_acc_data$STATE[t_acc_data$STATE == 47] <- "Tennessee"
t_acc_data$STATE[t_acc_data$STATE == 48] <- "Texas"
t_acc_data$STATE[t_acc_data$STATE == 49] <- "Utah"
t_acc_data$STATE[t_acc_data$STATE == 50] <- "Vermont"
t_acc_data$STATE[t_acc_data$STATE == 52] <- "Virgin Islands"
t_acc_data$STATE[t_acc_data$STATE == 51] <- "Virginia"
t_acc_data$STATE[t_acc_data$STATE == 53] <- "Washington"
t_acc_data$STATE[t_acc_data$STATE == 54] <- "West Virginia"
t_acc_data$STATE[t_acc_data$STATE == 55] <- "Wisconsin"
t_acc_data$STATE[t_acc_data$STATE == 56] <- "Wyoming"
t_acc_data$STATE <- toupper(t_acc_data$STATE)
t_acc_data <- as_tsibble(t_acc_data, key = STATE, index = Date2)
t_acc_data <- as_tsibble(t_acc_data, key = STATE, index = Date)
View(t_acc_data)
t_acc_data$Year <- substr(t_acc_data$Date, start = 1, stop = 4)
View(t_acc_data)
t_gdp_data$Year <- substr(t_gdp_data$Date, start = 1, stop = 4)
setwd("/Users/signeholdgaard/OneDrive - Aarhus universitet/Master/8 semester/Data Science/Exam/Coding/Data/GDP data/")
files <- list.files()
# create an empty list to store the data from the files
data_list <- list()
for(i in 1:length(files)){
file_name <- files[i]
d = fread(file_name, sep=",")
#Change columns names
colnames(d) <- c("Date","GDP")
# Split the string by "_"
filenames_vec <- strsplit(file_name, split = "_")[[1]]
# Create new column for state
d$State <- filenames_vec[2] # extract state name from filename
d$State <- sub("*\\.csv", "", d$State) # remove the .csv from the column
data_list[[i]] <- d # add the data to the list
}
# rbind all the data from the lists
gdp_data <- rbindlist(data_list)
# make it into a tsibble
t_gdp_data <- as_tsibble(gdp_data, key = State, index = Date)
View(t_gdp_data)
t_gdp_data$Year <- substr(t_gdp_data$Date, start = 1, stop = 4)
View(t_gdp_data)
t_acc_data %>%
rename(
State = STATE,
)
t_acc_data <- t_acc_data %>%
rename(
State = STATE)
new_dataset <- t_acc_data %>%
right_join(t_gdp_data, by=c("State","Year"))
new_dataset <- t_acc_data %>%
right_join(t_gdp_data, by=c("State","Year"))
setwd("/Users/signeholdgaard/OneDrive - Aarhus universitet/Master/8 semester/Data Science/Exam/Coding/Data/Fatality data/Data")
files <- list.files()
# create an empty list to store the data from the files
data_list <- list()
for(i in 1:length(files)){
file_name <- files[i]
d = fread(file_name, sep=",")
d = subset(d, select=c("STATE", "MONTH", "DAY", "YEAR", "HOUR", "MINUTE", "VE_FORMS", "DAY_WEEK", "FATALS", "ST_CASE"))
#Change columns names
#colnames(d) <- c("Date","GDP")
# Split the string by "_"
filenames_vec <- strsplit(file_name, split = "_")[[1]]
# Create new column for state
d$FYear <- filenames_vec[2] # extract state name from filename
d$FYear <- sub("*\\.csv", "", d$FYear) # remove the .csv from the column
d$FYear <- sub("*\\.CSV", "", d$FYear)
data_list[[i]] <- d # add the data to the list
}
# rbind all the data from the lists
acc_data <- rbindlist(data_list)
# add leading 0 if less than 2 digits
acc_data$DAY <- str_pad(acc_data$DAY, 2, pad = "0")
acc_data$MONTH <- str_pad(acc_data$MONTH, 2, pad = "0")
# make a full date column
acc_data$Date <- paste(acc_data$DAY, acc_data$MONTH, acc_data$FYear,sep="-")
acc_data <- mutate(acc_data, Date = as.Date(Date, format = "%d-%m-%Y"))
no_na <- filter(acc_data, !is.na(Date))
na_data <- filter(acc_data, is.na(Date))
# group by day to remove duplicates
group_acc_data <- no_na %>%
group_by(STATE, Date) %>%
summarise(fatality = sum(FATALS)) %>%
filter(!is.na(Date))
# make a copy of dataframe
t_acc_data <- group_acc_data
# Make states into names instead of numbers
t_acc_data$STATE[t_acc_data$STATE == 1] <- "Alabama"
t_acc_data$STATE[t_acc_data$STATE == 2] <- "Alaska"
t_acc_data$STATE[t_acc_data$STATE == 4] <- "Arizona"
t_acc_data$STATE[t_acc_data$STATE == 5] <- "Arkansas"
t_acc_data$STATE[t_acc_data$STATE == 6] <- "California"
t_acc_data$STATE[t_acc_data$STATE == 8] <- "Colorado"
t_acc_data$STATE[t_acc_data$STATE == 9] <- "Connecticut"
t_acc_data$STATE[t_acc_data$STATE == 10] <- "Delaware"
t_acc_data$STATE[t_acc_data$STATE == 11] <- "District of Columbia"
t_acc_data$STATE[t_acc_data$STATE == 12] <- "Florida"
t_acc_data$STATE[t_acc_data$STATE == 13] <- "Georgia"
t_acc_data$STATE[t_acc_data$STATE == 15] <- "Hawaii"
t_acc_data$STATE[t_acc_data$STATE == 16] <- "Idaho"
t_acc_data$STATE[t_acc_data$STATE == 17] <- "Illinois"
t_acc_data$STATE[t_acc_data$STATE == 18] <- "Indiana"
t_acc_data$STATE[t_acc_data$STATE == 19] <- "Iowa"
t_acc_data$STATE[t_acc_data$STATE == 20] <- "Kansas"
t_acc_data$STATE[t_acc_data$STATE == 21] <- "Kentucky"
t_acc_data$STATE[t_acc_data$STATE == 22] <- "Louisiana"
t_acc_data$STATE[t_acc_data$STATE == 23] <- "Maine"
t_acc_data$STATE[t_acc_data$STATE == 24] <- "Maryland"
t_acc_data$STATE[t_acc_data$STATE == 25] <- "Massachusetts"
t_acc_data$STATE[t_acc_data$STATE == 26] <- "Michigan"
t_acc_data$STATE[t_acc_data$STATE == 27] <- "Minnesota"
t_acc_data$STATE[t_acc_data$STATE == 28] <- "Mississippi"
t_acc_data$STATE[t_acc_data$STATE == 29] <- "Missouri"
t_acc_data$STATE[t_acc_data$STATE == 30] <- "Montana"
t_acc_data$STATE[t_acc_data$STATE == 31] <- "Nebraska"
t_acc_data$STATE[t_acc_data$STATE == 32] <- "Nevada"
t_acc_data$STATE[t_acc_data$STATE == 33] <- "New Hampshire"
t_acc_data$STATE[t_acc_data$STATE == 34] <- "New Jersey"
t_acc_data$STATE[t_acc_data$STATE == 35] <- "New Mexico"
t_acc_data$STATE[t_acc_data$STATE == 36] <- "New York"
t_acc_data$STATE[t_acc_data$STATE == 37] <- "North Carolina"
t_acc_data$STATE[t_acc_data$STATE == 38] <- "North Dakota"
t_acc_data$STATE[t_acc_data$STATE == 39] <- "Ohio"
t_acc_data$STATE[t_acc_data$STATE == 40] <- "Oklahoma"
t_acc_data$STATE[t_acc_data$STATE == 41] <- "Oregon"
t_acc_data$STATE[t_acc_data$STATE == 42] <- "Pennsylvania"
t_acc_data$STATE[t_acc_data$STATE == 43] <- "Puerto Rico"
t_acc_data$STATE[t_acc_data$STATE == 44] <- "Rhode Island"
t_acc_data$STATE[t_acc_data$STATE == 45] <- "South Carolina"
t_acc_data$STATE[t_acc_data$STATE == 46] <- "South Dakota"
t_acc_data$STATE[t_acc_data$STATE == 47] <- "Tennessee"
t_acc_data$STATE[t_acc_data$STATE == 48] <- "Texas"
t_acc_data$STATE[t_acc_data$STATE == 49] <- "Utah"
t_acc_data$STATE[t_acc_data$STATE == 50] <- "Vermont"
t_acc_data$STATE[t_acc_data$STATE == 52] <- "Virgin Islands"
t_acc_data$STATE[t_acc_data$STATE == 51] <- "Virginia"
t_acc_data$STATE[t_acc_data$STATE == 53] <- "Washington"
t_acc_data$STATE[t_acc_data$STATE == 54] <- "West Virginia"
t_acc_data$STATE[t_acc_data$STATE == 55] <- "Wisconsin"
t_acc_data$STATE[t_acc_data$STATE == 56] <- "Wyoming"
# make it uppercase to fit the GDP dataframe
t_acc_data$STATE <- toupper(t_acc_data$STATE)
# make it into a time series dataframe
#t_acc_data <- as_tsibble(t_acc_data, key = STATE, index = Date)
# make two columns to match by in the dataframes
t_acc_data$Year <- substr(t_acc_data$Date, start = 1, stop = 4)
t_gdp_data$Year <- substr(t_gdp_data$Date, start = 1, stop = 4)
t_acc_data <- t_acc_data %>%
rename(
State = STATE)
new_dataset <- t_acc_data %>%
right_join(gdp_data, by=c("State","Year"))
gdp_data$Year <- substr(gdp_data$Date, start = 1, stop = 4)
new_dataset <- t_acc_data %>%
right_join(gdp_data, by=c("State","Year"))
View(no_na)
View(new_dataset)
View(t_acc_data)
full_data <- full_data %>%
rename(
Date = Date.x,
Date_GDP = Date.y)
full_data <- t_acc_data %>%
right_join(gdp_data, by=c("State","Year"))
full_data <- full_data %>%
rename(
Date = Date.x,
Date_GDP = Date.y)
t_full_data <- as_tsibble(full_data, key = State, index = Date)
na_full <- filter(na_full, is.na(Date))
na_full <- filter(full_data, is.na(Date))
View(na_full)
# remove 2020 from GDP data
gdp_data <- filter(gdp_data, Year != "2020")
# make two columns to match by in the dataframes
t_acc_data$Year <- substr(t_acc_data$Date, start = 1, stop = 4)
gdp_data$Year <- substr(gdp_data$Date, start = 1, stop = 4)
# remove 2020 from GDP data
gdp_data <- filter(gdp_data, Year != "2020")
t_acc_data <- t_acc_data %>%
rename(
State = STATE)
full_data <- t_acc_data %>%
right_join(gdp_data, by=c("State","Year"))
full_data <- full_data %>%
rename(
Date = Date.x,
Date_GDP = Date.y)
t_full_data <- as_tsibble(full_data, key = State, index = Date)
na_full <- filter(full_data, is.na(Date))
View(na_full)
# make two columns to match by in the dataframes
t_acc_data$Year <- substr(t_acc_data$Date, start = 1, stop = 4)
gdp_data$Year <- substr(gdp_data$Date, start = 1, stop = 4)
# remove 2020 from GDP data
gdp_data <- filter(gdp_data, Year != "2020")
# rename column
t_acc_data <- t_acc_data %>%
rename(
State = STATE)
# GDP rename
gdp_data$STATE[gdp_data$STATE == "NORTHDAKOTA"] <- "NORTH DAKOTA"
gdp_data$STATE[gdp_data$STATE == "SOUTHDAKOTA"] <- "SOUTH DAKOTA"
gdp_data$STATE[gdp_data$STATE == "NEWMEXICO"] <- "NEW MEXICO"
gdp_data$STATE[gdp_data$STATE == "WESTVIRGINIA"] <- "WEST VIRGINIA"
gdp_data$STATE[gdp_data$STATE == "NEWYORK"] <- "NEW YORK"
gdp_data$STATE[gdp_data$STATE == "NORTHCAROLINA"] <- "NORTH CAROLINA"
gdp_data$STATE[gdp_data$STATE == "NEWJERSEY"] <- "NEW JERSEY"
gdp_data$STATE[gdp_data$STATE == "SOUTHCAROLINA"] <- "SOUTH CAROLINA"
gdp_data$STATE[gdp_data$STATE == "NEWHAMPSHIRE"] <- "NEW HAMPSHIRE"
gdp_data$STATE[gdp_data$STATE == "DISTRICTOFCOLUMBIA"] <- "DISTRICT OF COLUMBIA"
# merge dataframes
full_data <- t_acc_data %>%
right_join(gdp_data, by=c("State","Year"))
# rename columns
full_data <- full_data %>%
rename(
Date = Date.x,
Date_GDP = Date.y)
# make it into a tsibble
t_full_data <- as_tsibble(full_data, key = State, index = Date)
na_full <- filter(full_data, is.na(Date))
View(na_full)
# make two columns to match by in the dataframes
t_acc_data$Year <- substr(t_acc_data$Date, start = 1, stop = 4)
gdp_data$Year <- substr(gdp_data$Date, start = 1, stop = 4)
# remove 2020 from GDP data
gdp_data <- filter(gdp_data, Year != "2020")
# rename column
t_acc_data <- t_acc_data %>%
rename(
State = STATE)
# GDP rename
gdp_data$State[gdp_data$State == "NORTHDAKOTA"] <- "NORTH DAKOTA"
gdp_data$State[gdp_data$State == "SOUTHDAKOTA"] <- "SOUTH DAKOTA"
gdp_data$State[gdp_data$State == "NEWMEXICO"] <- "NEW MEXICO"
gdp_data$State[gdp_data$State == "WESTVIRGINIA"] <- "WEST VIRGINIA"
gdp_data$State[gdp_data$State == "NEWYORK"] <- "NEW YORK"
gdp_data$State[gdp_data$State == "NORTHCAROLINA"] <- "NORTH CAROLINA"
gdp_data$State[gdp_data$State == "NEWJERSEY"] <- "NEW JERSEY"
gdp_data$State[gdp_data$State == "SOUTHCAROLINA"] <- "SOUTH CAROLINA"
gdp_data$State[gdp_data$State == "NEWHAMPSHIRE"] <- "NEW HAMPSHIRE"
gdp_data$State[gdp_data$State == "DISTRICTOFCOLUMBIA"] <- "DISTRICT OF COLUMBIA"
# merge dataframes
full_data <- t_acc_data %>%
right_join(gdp_data, by=c("State","Year"))
# rename columns
full_data <- full_data %>%
rename(
Date = Date.x,
Date_GDP = Date.y)
# make it into a tsibble
t_full_data <- as_tsibble(full_data, key = State, index = Date)
na_full <- filter(full_data, is.na(Date))
View(na_full)
# make two columns to match by in the dataframes
t_acc_data$Year <- substr(t_acc_data$Date, start = 1, stop = 4)
gdp_data$Year <- substr(gdp_data$Date, start = 1, stop = 4)
# remove 2020 from GDP data
gdp_data <- filter(gdp_data, Year != "2020")
# rename column
t_acc_data <- t_acc_data %>%
rename(
State = STATE)
# GDP rename
gdp_data$State[gdp_data$State == "NORTHDAKOTA"] <- "NORTH DAKOTA"
gdp_data$State[gdp_data$State == "SOUTHDAKOTA"] <- "SOUTH DAKOTA"
gdp_data$State[gdp_data$State == "NEWMEXICO"] <- "NEW MEXICO"
gdp_data$State[gdp_data$State == "WESTVIRGINA"] <- "WEST VIRGINA"
gdp_data$State[gdp_data$State == "NEWYORK"] <- "NEW YORK"
gdp_data$State[gdp_data$State == "NORTHCAROLINA"] <- "NORTH CAROLINA"
gdp_data$State[gdp_data$State == "NEWJERSEY"] <- "NEW JERSEY"
gdp_data$State[gdp_data$State == "SOUTHCAROLINA"] <- "SOUTH CAROLINA"
gdp_data$State[gdp_data$State == "NEWHAMPSHIRE"] <- "NEW HAMPSHIRE"
gdp_data$State[gdp_data$State == "DISTRICTOFCOLUMBIA"] <- "DISTRICT OF COLUMBIA"
gdp_data$State[gdp_data$State == "RHODEISLAND"] <- "RHODE ISLAND"
# merge dataframes
full_data <- t_acc_data %>%
right_join(gdp_data, by=c("State","Year"))
# rename columns
full_data <- full_data %>%
rename(
Date = Date.x,
Date_GDP = Date.y)
# make it into a tsibble
t_full_data <- as_tsibble(full_data, key = State, index = Date)
na_full <- filter(full_data, is.na(Date))
View(na_full)
# make two columns to match by in the dataframes
t_acc_data$Year <- substr(t_acc_data$Date, start = 1, stop = 4)
gdp_data$Year <- substr(gdp_data$Date, start = 1, stop = 4)
# remove 2020 from GDP data
gdp_data <- filter(gdp_data, Year != "2020")
# rename column
t_acc_data <- t_acc_data %>%
rename(
State = STATE)
# GDP rename
gdp_data$State[gdp_data$State == "NORTHDAKOTA"] <- "NORTH DAKOTA"
gdp_data$State[gdp_data$State == "SOUTHDAKOTA"] <- "SOUTH DAKOTA"
gdp_data$State[gdp_data$State == "NEWMEXICO"] <- "NEW MEXICO"
gdp_data$State[gdp_data$State == "WESTVIRGINA"] <- "WEST VIRGINIA"
gdp_data$State[gdp_data$State == "NEWYORK"] <- "NEW YORK"
gdp_data$State[gdp_data$State == "NORTHCAROLINA"] <- "NORTH CAROLINA"
gdp_data$State[gdp_data$State == "NEWJERSEY"] <- "NEW JERSEY"
gdp_data$State[gdp_data$State == "SOUTHCAROLINA"] <- "SOUTH CAROLINA"
gdp_data$State[gdp_data$State == "NEWHAMPSHIRE"] <- "NEW HAMPSHIRE"
gdp_data$State[gdp_data$State == "DISTRICTOFCOLUMBIA"] <- "DISTRICT OF COLUMBIA"
gdp_data$State[gdp_data$State == "RHODEISLAND"] <- "RHODE ISLAND"
# merge dataframes
full_data <- t_acc_data %>%
right_join(gdp_data, by=c("State","Year"))
# rename columns
full_data <- full_data %>%
rename(
Date = Date.x,
Date_GDP = Date.y)
# make it into a tsibble
t_full_data <- as_tsibble(full_data, key = State, index = Date)
na_full <- filter(full_data, is.na(Date))
View(na_full)
setwd("/Users/signeholdgaard/OneDrive - Aarhus universitet/Master/8 semester/Data Science/Exam/Coding/Data/GDP data/")
files <- list.files()
# create an empty list to store the data from the files
data_list <- list()
for(i in 1:length(files)){
file_name <- files[i]
d = fread(file_name, sep=",")
#Change columns names
colnames(d) <- c("Date","GDP")
# Split the string by "_"
filenames_vec <- strsplit(file_name, split = "_")[[1]]
# Create new column for state
d$State <- filenames_vec[2] # extract state name from filename
d$State <- sub("*\\.csv", "", d$State) # remove the .csv from the column
data_list[[i]] <- d # add the data to the list
}
# rbind all the data from the lists
gdp_data <- rbindlist(data_list)
# make it into a tsibble
#t_gdp_data <- as_tsibble(gdp_data, key = State, index = Date)
# make two columns to match by in the dataframes
t_acc_data$Year <- substr(t_acc_data$Date, start = 1, stop = 4)
gdp_data$Year <- substr(gdp_data$Date, start = 1, stop = 4)
# remove 2020 from GDP data
gdp_data <- filter(gdp_data, Year != "2020")
# rename column
t_acc_data <- t_acc_data %>%
rename(
State = STATE)
# GDP rename
gdp_data$State[gdp_data$State == "NORTHDAKOTA"] <- "NORTH DAKOTA"
gdp_data$State[gdp_data$State == "SOUTHDAKOTA"] <- "SOUTH DAKOTA"
gdp_data$State[gdp_data$State == "NEWMEXICO"] <- "NEW MEXICO"
gdp_data$State[gdp_data$State == "WESTVIRGINA"] <- "WEST VIRGINIA"
gdp_data$State[gdp_data$State == "NEWYORK"] <- "NEW YORK"
gdp_data$State[gdp_data$State == "NORTHCAROLINA"] <- "NORTH CAROLINA"
gdp_data$State[gdp_data$State == "NEWJERSEY"] <- "NEW JERSEY"
gdp_data$State[gdp_data$State == "SOUTHCAROLINA"] <- "SOUTH CAROLINA"
gdp_data$State[gdp_data$State == "NEWHAMPSHIRE"] <- "NEW HAMPSHIRE"
gdp_data$State[gdp_data$State == "DISTRICTOFCOLUMBIA"] <- "DISTRICT OF COLUMBIA"
gdp_data$State[gdp_data$State == "RHODEISLAND"] <- "RHODE ISLAND"
# merge dataframes
full_data <- t_acc_data %>%
right_join(gdp_data, by=c("State","Year"))
# rename columns
full_data <- full_data %>%
rename(
Date = Date.x,
Date_GDP = Date.y)
# make it into a tsibble
t_full_data <- as_tsibble(full_data, key = State, index = Date)
na_full <- filter(full_data, is.na(Date))
View(t_acc_data)
setwd("/Users/signeholdgaard/OneDrive - Aarhus universitet/Master/8 semester/Data Science/Exam/Coding/Data/GDP data/")
files <- list.files()
# create an empty list to store the data from the files
data_list <- list()
for(i in 1:length(files)){
file_name <- files[i]
d = fread(file_name, sep=",")
#Change columns names
colnames(d) <- c("Date","GDP")
# Split the string by "_"
filenames_vec <- strsplit(file_name, split = "_")[[1]]
# Create new column for state
d$State <- filenames_vec[2] # extract state name from filename
d$State <- sub("*\\.csv", "", d$State) # remove the .csv from the column
data_list[[i]] <- d # add the data to the list
}
# rbind all the data from the lists
gdp_data <- rbindlist(data_list)
# make it into a tsibble
#t_gdp_data <- as_tsibble(gdp_data, key = State, index = Date)
# make two columns to match by in the dataframes
t_acc_data$Year <- substr(t_acc_data$Date, start = 1, stop = 4)
gdp_data$Year <- substr(gdp_data$Date, start = 1, stop = 4)
# remove 2020 from GDP data
gdp_data <- filter(gdp_data, Year != "2020")
# rename column
t_acc_data <- t_acc_data %>%
rename(
State = STATE)
# GDP rename
gdp_data$State[gdp_data$State == "NORTHDAKOTA"] <- "NORTH DAKOTA"
gdp_data$State[gdp_data$State == "SOUTHDAKOTA"] <- "SOUTH DAKOTA"
gdp_data$State[gdp_data$State == "NEWMEXICO"] <- "NEW MEXICO"
gdp_data$State[gdp_data$State == "WESTVIRGINA"] <- "WEST VIRGINIA"
gdp_data$State[gdp_data$State == "NEWYORK"] <- "NEW YORK"
gdp_data$State[gdp_data$State == "NORTHCAROLINA"] <- "NORTH CAROLINA"
gdp_data$State[gdp_data$State == "NEWJERSEY"] <- "NEW JERSEY"
gdp_data$State[gdp_data$State == "SOUTHCAROLINA"] <- "SOUTH CAROLINA"
gdp_data$State[gdp_data$State == "NEWHAMPSHIRE"] <- "NEW HAMPSHIRE"
gdp_data$State[gdp_data$State == "DISTRICTOFCOLUMBIA"] <- "DISTRICT OF COLUMBIA"
gdp_data$State[gdp_data$State == "RHODEISLAND"] <- "RHODE ISLAND"
gdp_data$State[gdp_data$State == "ILLIONOIS"] <- "ILLINOIS"
# merge dataframes
full_data <- t_acc_data %>%
right_join(gdp_data, by=c("State","Year"))
# rename columns
full_data <- full_data %>%
rename(
Date = Date.x,
Date_GDP = Date.y)
# make it into a tsibble
t_full_data <- as_tsibble(full_data, key = State, index = Date)
na_full <- filter(full_data, is.na(Date))
View(t_full_data)
# plot
autoplot(t_full_data, fatality)
t_full_data %>%
features(fatality, list(mean = mean)) %>%
arrange(mean)
model(trend_model = TSLM(fatality ~ GDP)
fit <- t_full_data %>%
model(trend_model = TSLM(fatality ~ GDP))
fit <- t_full_data %>%
model(trend_model = NAIVE(fatality ~ GDP))
fit %>%
forecast(h = "3 years") %>%
filter(STATE == "California") %>%
autoplot(t_acc_data) +
labs(y = "$US", title = "Fatality california")
fit %>%
forecast(h = "3 years") %>%
filter(STATE == "CALIFORNIA") %>%
autoplot(t_acc_data) +
labs(y = "$US", title = "Fatality california")
fit %>%
forecast(h = "3 years") %>%
filter(State == "CALIFORNIA") %>%
autoplot(t_acc_data) +
labs(y = "$US", title = "Fatality california")
fit %>%
forecast(h = "3 years") %>%
filter(State == "CALIFORNIA") %>%
autoplot(t_full_data) +
labs(y = "$US", title = "Fatality california")
fit <- t_full_data %>%
model(trend_model = NAIVE(fatality ~ trend()))
fit %>%
forecast(h = "3 years") %>%
filter(State == "CALIFORNIA") %>%
autoplot(t_full_data) +
labs(y = "$US", title = "Fatality california")
